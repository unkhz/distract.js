/*
 * Distract.js
 * Distract your audience
 *
 * Juhani Pelli <juhani.pelli@gmail.com>
 * https://github.com/unkhz/distract.js/
 *
 * MIT License
 *
 */
!function(a,b){"function"==typeof define&&define.amd?define([],b):a.Distract=b(a)}(this,function(a){function b(){var a,c,d,e=arguments[0],f=Array.prototype.slice.call(arguments,1);for(a=0,d=f.length;d>a;a++){var g=f[a];if(g)for(c in g)"[object Object]"===Object.prototype.toString.call(e[c])&&"[object Object]"===Object.prototype.toString.call(g[c])?b(e[c],g[c]):e[c]=g[c]}return e}function c(a,b,c,d){var e;return e=typeof a[b]==typeof Function?a[b].apply(null,c):a[b],void 0===e?d:e}function d(a){if(j[a])return j[a];var b;void 0!==k.style[a]&&(b=a);for(var c=0,d=["webkit","moz","o","ms"],e=d.length;e>c;c++){var f=d[c]+a.charAt(0).toUpperCase()+a.slice(1);void 0!==document.body.style[f]&&(b=f)}return j[a]=b}function e(a){var b=a[0],c=a[1];return void 0===b&&(b="0"+c),"number"==typeof b?b.toString()+c:b}function f(a,b){var c,d,e={};for(c in b)d=b[c],d=d.join?d[Math.ceil(Math.random()*d.length)-1]:d,e[c]=typeof d==typeof Function&&m.indexOf(c)<0?d(a,b):d;return e}function g(){this.opts=new o,this.particleOpts=new l,this.particles=[],this.particlesToBeDestroyed=[],this.lastId=-1,this.particleCheckId=-1,this.configure.apply(this,arguments),this.animate()}var h={},i=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(a){setTimeout(a,1)},j={},k=document.createElement("div"),l=function(a){b(this,a)},m=["initState","iterateState","parseIterationRule"];l.prototype.text="undefined",l.prototype.className="",l.prototype.iterationSpeed=1,l.prototype.respawn=!1,l.prototype.iterationRules=[],l.prototype.parseIterationRule=function(a,b){var d=c(a,"property",arguments),e=c(a,"propertyFunction",arguments),f=c(a,"inc",arguments),g=c(a,"speed",arguments,1),h=c(a,"max",arguments,1/0),i=c(a,"min",arguments,-1/0),j=b.style[d]=b.style[d]||[],k=e?j[e][0]:j[0],l=Math.min(Math.max(k+f*g,i),h);e?b.style[d][e][0]=l:b.style[d][0]=l},l.prototype.initState=function(){return{style:{}}},l.prototype.iterateState=function(a,b,c){for(var d=0,e=c.iterationRules.length;e>d;d++){var f=c.iterationRules[d];(f.parse?f.parse:c.parseIterationRule)(f,b,c,a)}return b};var n=function(a){b(this,a),this.state=c(this.opts,"initState",[this.id,this.opts],{}),this.animate()};n.prototype.animate=function(){var a=this,b=function(){if(a.destruct){if(!(a.destructOpacity>0))return a.el.parentNode.removeChild(a.el),void(a.isDestroyed=!0);a.render(),a.destructOpacity-=Math.max(a.state.style.opacity/10,.005),a.el.style.opacity=Math.max(0,Number(a.state.style.opacity)*a.destructOpacity)}else(!a.initialized||Math.random()<a.opts.iterationSpeed)&&a.render();i(b,a.el)};i(b,a.el)},n.prototype.destroy=function(){this.destruct=!0,this.destructOpacity=1},n.prototype.render=function(){var a,b=this.opts;if(!this.initialized){this.el.className="distract-particle "+b.className,this.el.innerHTML=b.text;for(a in b.style)this.el.style[d(a)]=c(b.style,a);this.initialized=!0}var f=this.opts.iterateState(this,this.state,this.opts);for(a in f.style)if("[object Object]"===Object.prototype.toString.call(f.style[a])){var g,h=[];for(g in f.style[a])h.push(g+"("+e(f.style[a][g],g)+")");this.el.style[d(a)]=h.join(" ")}else this.el.style[d(a)]=e(f.style[a],a)};var o=function(a){b(this,a)};return o.prototype.enabled=!0,o.prototype.el=document.body,o.prototype.particleEl=function(){return document.createElement("div")},o.prototype.particleCount=8,g.prototype.configure=function(a,c){b(this.opts,a),b(this.particleOpts,c),this.particlesToBeDestroyed.concat(this.particles||[]),this.particles=[]},g.prototype.pause=function(){this.paused=!0},g.prototype.animate=function(){this.paused=!1;var a=this,b=function(){if(!a.paused){var d,e,g,h,j=a.opts,k=a.particles.length;j.enabled&&k<j.particleCount?(d=++a.lastId,e=c(j,"particleEl",[d,j]),g=new n({id:d,el:e,layer:a,opts:new l(f(d,a.particleOpts))}),a.opts.el.appendChild(e),a.particles.push(g)):k>0&&(!a.opts.enabled||Number(a.opts.respawn))&&(g=a.particles.shift(),g.destroy()),k>0&&(h=++a.particleCheckId%a.particles.length,g=a.particles[h],g&&g.isDestroyed&&(delete a.particles[h],a.particles.splice(h,1))),a.particlesToBeDestroyed.length>0&&(g=a.particlesToBeDestroyed.shift(),g.destroy()),i(b)}};i(b)},h={LayerOptions:o,Layer:g,ParticleOptions:l,Particle:n}});