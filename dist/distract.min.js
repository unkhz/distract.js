/*
 * Distract.js
 * Distract your audience
 *
 * Juhani Pelli <juhani.pelli@gmail.com>
 * https://github.com/unkhz/distract.js/
 *
 * MIT License
 *
 */
!function(a,b){"function"==typeof define&&define.amd?define([],b):a.Distract=b(a)}(this,function(a){function b(){var a,c,d,e=arguments[0],f=Array.prototype.slice.call(arguments,1);for(a=0,d=f.length;d>a;a++){var h=f[a];if(h)for(c in h)"[object Object]"===g.call(e[c])&&"[object Object]"===g.call(h[c])?b(e[c],h[c]):e[c]=h[c]}return e}function c(a,b,c,d){var e;return e=typeof a[b]==typeof Function?a[b].apply(null,c):a[b],void 0===e?d:e}function d(a){if(i[a])return i[a];var b;if(void 0!==j.style[a])b=a;else for(var c=0,d=["webkit","moz","Moz","o","ms"],e=d.length;e>c;c++){var f=d[c]+a.charAt(0).toUpperCase()+a.slice(1);void 0!==document.body.style[f]&&(b=f)}return i[a]=b}function e(a){var b=a[0],c=a[1];return void 0===b&&(b="0"+c),"number"==typeof b?b.toString()+c:b}function f(a,b){var c,d,e={};for(c in b)d=b[c],d=d.join?d[Math.ceil(Math.random()*d.length)-1]:d,e[c]=typeof d==typeof Function&&l.indexOf(c)<0?d(a,b):d;return e}var g=Object.prototype.toString,h=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(a){setTimeout(a,1)},i={},j=document.createElement("div"),k=function(a){b(this,a)},l=["initState","iterateState","parseIterationRule"];b(k.prototype,{text:"undefined",className:"",iterationSpeed:1,respawn:!1,iterationRules:[],parseIterationRule:function(a,b){var d=c(a,"property",arguments),e=c(a,"propertyFunction",arguments),f=c(a,"inc",arguments),g=c(a,"speed",arguments,1),h=c(a,"max",arguments,1/0),i=c(a,"min",arguments,-1/0),j=b.style[d]=b.style[d]||[],k=e?j[e][0]:j[0],l=Math.min(Math.max(k+f*g,i),h);e?b.style[d][e][0]=l:b.style[d][0]=l},initState:function(){return{style:{}}},iterateState:function(a,b,c){for(var d=0,e=c.iterationRules.length;e>d;d++){var f=c.iterationRules[d];(f.parse?f.parse:c.parseIterationRule)(f,b,c,a)}return b}});var m=function(a){b(this,a),this.state=c(this.opts,"initState",[this.id,this.opts],{}),this.animate()};b(m.prototype,{animate:function(){var a=this,b=function(){if(a.destruct){if(!(a.destructOpacity>0))return a.el.parentNode.removeChild(a.el),void(a.isDestroyed=!0);a.render(),a.destructOpacity-=Math.max(a.state.style.opacity/10,.005),a.el.style.opacity=Math.max(0,Number(a.state.style.opacity)*a.destructOpacity)}else(!a.initialized||Math.random()<a.opts.iterationSpeed)&&a.render();h(b,a.el)};h(b,a.el)},destroy:function(){this.destruct=!0,this.destructOpacity=1},render:function(){var a,b=this.opts,f=this.el;if(!this.initialized){f.className="distract-particle "+b.className,f.innerHTML=b.text;for(a in b.style)f.style[d(a)]=c(b.style,a);this.initialized=!0}var h,i,j,k=b.iterateState(this,this.state,this.opts);for(a in k.style||{})if(h=k.style[a],"[object Object]"===g.call(h)){j=[];for(i in h)j.push(i+"("+e(h[i],i)+")");f.style[d(a)]=j.join(" ")}else f.style[d(a)]=e(h,a);for(a in k.attributes||{})if(h=k.attributes[a],"[object Object]"===g.call(h)){j=[];for(i in h)j.push(i+"("+e(h[i],i)+")");f.setAttribute(a,j.join(" "))}else f.setAttribute(a,e(h,a))}});var n=function(a){b(this,a)};b(n.prototype,{enabled:!0,el:document.body,particleEl:function(){return document.createElement("div")},particleCount:8});var o=function(){b(this,{opts:new n,particleOpts:new k,particles:[],particlesToBeDestroyed:[],lastId:-1,particleCheckId:-1}),this.configure.apply(this,arguments),this.animate()};return b(o.prototype,{configure:function(a,c){b(this.opts,a),b(this.particleOpts,c),this.particlesToBeDestroyed.concat(this.particles||[]),this.particles=[]},pause:function(){this.paused=!0},animate:function(){this.paused=!1;var a=this,b=function(){if(!a.paused){var d,e,g,i,j=a.opts,l=a.particles.length;j.enabled&&l<j.particleCount?(d=++a.lastId,e=c(j,"particleEl",[d,j]),g=new m({id:d,el:e,layer:a,opts:new k(f(d,a.particleOpts))}),a.opts.el.appendChild(e),a.particles.push(g)):l>0&&(!a.opts.enabled||Number(a.opts.respawn))&&(g=a.particles.shift(),g.destroy()),l>0&&(i=++a.particleCheckId%a.particles.length,g=a.particles[i],g&&g.isDestroyed&&(delete a.particles[i],a.particles.splice(i,1))),a.particlesToBeDestroyed.length>0&&(g=a.particlesToBeDestroyed.shift(),g.destroy()),h(b)}};h(b)}}),{Layer:o,LayerOptions:n,Particle:m,ParticleOptions:k}});