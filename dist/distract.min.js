/*
 * Distract.js
 * Distract your audience
 *
 * Juhani Pelli <juhani.pelli@gmail.com>
 * https://github.com/unkhz/distract.js/
 *
 * MIT License
 *
 */
!function(a,b){"function"==typeof define&&define.amd?define([],b):a.Distract=b(a)}(this,function(a){function b(){var a,c,d,e=arguments[0],f=h.call(arguments,1);for(a=0,d=f.length;d>a;a++){var g=f[a];if(g)for(c in g)"[object Object]"===Object.prototype.toString.call(e[c])&&"[object Object]"===Object.prototype.toString.call(g[c])?b(e[c],g[c]):e[c]=g[c]}return e}function c(a,b,c,d){var e;return e=typeof a[b]==typeof Function?a[b].apply(null,c):a[b],void 0===e?d:e}function d(a){if(m[a])return m[a];var b;void 0!==l.style[a]&&(b=a);for(var c=0,d=["webkit","moz","o","ms"],e=d.length;e>c;c++){var f=d[c]+a.charAt(0).toUpperCase()+a.slice(1);void 0!==document.body.style[f]&&(b=f)}return m[a]=b}function e(a){var b=a[0],c=a[1];return void 0===b&&(b="0"+c),"number"==typeof b?b.toString()+c:b}function f(a,b){var c,d,e={};for(c in b)d=b[c],d=d.join?d[Math.ceil(Math.random()*d.length)-1]:d,e[c]=typeof d==typeof Function&&i.indexOf(c)<0?d(a,b):d;return e}function g(){this.opts=b({},j),this.particleOpts=b({},k),this.particles=[],this.particlesToBeDestroyed=[],this.lastId=-1,this.particleCheckId=-1,this.configure.apply(this,arguments),this.animate()}var h=Array.prototype.slice,i=["initState","iterateState","parseIterationRule"],j={enabled:!0,el:document.body,particleEl:function(){return document.createElement("div")},particleCount:"8"},k={text:"undefined",className:"",iterationSpeed:1,respawn:0,minOpacity:.66,maxOpacity:1,iterationRules:[],parseIterationRule:function(a,b){var d=c(a,"property",arguments),e=c(a,"propertyFunction",arguments),f=c(a,"inc",arguments),g=c(a,"speed",arguments,1),h=c(a,"max",arguments,1/0),i=c(a,"min",arguments,-1/0),j=b.style[d]=b.style[d]||[],k=e?j[e][0]:j[0],l=Math.min(Math.max(k+f*g,i),h);e?b.style[d][e][0]=l:b.style[d][0]=l},initState:function(){return{style:{}}},iterateState:function(a,b,c){for(var d=0,e=c.iterationRules.length;e>d;d++){var f=c.iterationRules[d];(f.parse?f.parse:c.parseIterationRule)(f,b,c,a)}return b}},l=document.createElement("div"),m={},n=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(a){setTimeout(a,1)},o=function(a){b(this,a),this.state=c(this.opts,"initState",[this.id,this.opts],{}),this.animate()};return o.prototype.animate=function(){var a=this,b=function(){if(a.destruct){if(!(a.destructOpacity>0))return a.el.parentNode.removeChild(a.el),a.isDestroyed=!0,void 0;a.render(),a.destructOpacity-=Math.max(a.state.style.opacity/10,.005),a.el.style.opacity=Math.max(0,Number(a.state.style.opacity)*a.destructOpacity)}else(!a.initialized||Math.random()<a.opts.iterationSpeed)&&a.render();n(b,a.el)};n(b,a.el)},o.prototype.destroy=function(){this.destruct=!0,this.destructOpacity=1},o.prototype.render=function(){var a,b=this.opts;if(!this.initialized){this.el.className="distract-particle "+b.className,this.el.innerHTML=b.text;for(a in b.style)this.el.style[d(a)]=c(b.style,a);this.initialized=!0}var f=this.opts.iterateState(this,this.state,this.opts);for(a in f.style)if("[object Object]"===Object.prototype.toString.call(f.style[a])){var g,h=[];for(g in f.style[a])h.push(g+"("+e(f.style[a][g],g)+")");this.el.style[d(a)]=h.join(" ")}else this.el.style[d(a)]=e(f.style[a],a)},g.prototype.configure=function(a,c){b(this.opts,a),b(this.particleOpts,c),this.particlesToBeDestroyed.concat(this.particles||[]),this.particles=[]},g.prototype.pause=function(){this.paused=!0},g.prototype.animate=function(){this.paused=!1;var a=this,b=function(){if(!a.paused){var d,e,g,h,i=a.opts,j=a.particles.length;i.enabled&&j<i.particleCount?(d=++a.lastId,e=c(i,"particleEl",[d,i]),g=new o({id:d,el:e,layer:a,opts:f(d,a.particleOpts)}),a.opts.el.appendChild(e),a.particles.push(g)):j>0&&(!a.opts.enabled||Number(a.opts.respawn))&&(g=a.particles.shift(),g.destroy()),j>0&&(h=++a.particleCheckId%a.particles.length,g=a.particles[h],g&&g.isDestroyed&&(delete a.particles[h],a.particles.splice(h,1))),a.particlesToBeDestroyed.length>0&&(g=a.particlesToBeDestroyed.shift(),g.destroy()),n(b)}};n(b)},{Layer:g,Particle:o}});